---
title: "Class 22: Working with Network Data"
author: "Taylor Arnold"
output: html_notebook
---




{% highlight r %}
library(readr)
library(dplyr)
library(ggplot2)
library(viridis)
{% endhighlight %}

![](../assets/img/data_pipeline_visualize.png)




{% highlight r %}
edges
{% endhighlight %}



{% highlight text %}
## # A tibble: 17 x 2
##         id  id_out
##      <chr>   <chr>
##  1  Albert   Betty
##  2  Albert Claudia
##  3  Albert  Dieter
##  4  Albert  Flavia
##  5   Betty  Dieter
##  6   Betty      Ed
##  7   Betty    Gaby
##  8 Claudia  Dieter
##  9 Claudia  Flavia
## 10  Dieter      Ed
## 11  Dieter  Flavia
## 12  Dieter    Gaby
## 13      Ed    Gaby
## 14  Flavia    Gaby
## 15  Flavia  Hellen
## 16    Gaby  Hellen
## 17  Hellen     Ida
{% endhighlight %}


{% highlight r %}
nodes
{% endhighlight %}



{% highlight text %}
## # A tibble: 9 x 3
##        id   age  belt
##     <chr> <int> <chr>
## 1  Albert    14 green
## 2   Betty    12 black
## 3 Claudia    17 green
## 4  Dieter    16 green
## 5      Ed    17 green
## 6  Flavia    14 black
## 7    Gaby    15 white
## 8  Hellen    14 green
## 9     Ida    18 green
{% endhighlight %}



{% highlight r %}
library(smodels)
z <- graph_data(nodes, edges)
{% endhighlight %}



{% highlight text %}
## Error in inner_join_impl(x, y, by$x, by$y, suffix$x, suffix$y, check_na_matches(na_matches)): Can't join on 'id' x 'id' because of incompatible types (character / integer)
{% endhighlight %}



{% highlight r %}
nodes <- z$nodes
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'z' not found
{% endhighlight %}



{% highlight r %}
edges <- z$edges
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'z' not found
{% endhighlight %}



{% highlight r %}
nodes
{% endhighlight %}



{% highlight text %}
## # A tibble: 9 x 3
##        id   age  belt
##     <chr> <int> <chr>
## 1  Albert    14 green
## 2   Betty    12 black
## 3 Claudia    17 green
## 4  Dieter    16 green
## 5      Ed    17 green
## 6  Flavia    14 black
## 7    Gaby    15 white
## 8  Hellen    14 green
## 9     Ida    18 green
{% endhighlight %}


{% highlight r %}
edges
{% endhighlight %}



{% highlight text %}
## # A tibble: 17 x 2
##         id  id_out
##      <chr>   <chr>
##  1  Albert   Betty
##  2  Albert Claudia
##  3  Albert  Dieter
##  4  Albert  Flavia
##  5   Betty  Dieter
##  6   Betty      Ed
##  7   Betty    Gaby
##  8 Claudia  Dieter
##  9 Claudia  Flavia
## 10  Dieter      Ed
## 11  Dieter  Flavia
## 12  Dieter    Gaby
## 13      Ed    Gaby
## 14  Flavia    Gaby
## 15  Flavia  Hellen
## 16    Gaby  Hellen
## 17  Hellen     Ida
{% endhighlight %}


{% highlight r %}
ggplot(nodes, aes(x, y)) +
  geom_point(size = 10) +
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'x' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-8-1.png" title="plot of chunk unnamed-chunk-8" alt="plot of chunk unnamed-chunk-8" width="100%" />


{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9, size = 4) +
  geom_point(aes(color = belt), size = 15) +
  geom_text(aes(y = y - 0.15), size = 8) +
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-9-1.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" width="100%" />





{% highlight r %}
library(plotly)
{% endhighlight %}



{% highlight text %}
## 
## Attaching package: 'plotly'
{% endhighlight %}



{% highlight text %}
## The following object is masked from 'package:ggplot2':
## 
##     last_plot
{% endhighlight %}



{% highlight text %}
## The following object is masked from 'package:stats':
## 
##     filter
{% endhighlight %}



{% highlight text %}
## The following object is masked from 'package:graphics':
## 
##     layout
{% endhighlight %}



{% highlight r %}
ggplotly()
{% endhighlight %}



{% highlight text %}
## We recommend that you use the dev version of ggplot2 with `ggplotly()`
## Install it with: `devtools::install_github('hadley/ggplot2')`
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

## Centrality


{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9, size = 4) +
  geom_point(aes(color = eigen), size = 15) +
  geom_text(aes(y = y - 0.15), size = 8) +
  scale_color_viridis() +
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-11-1.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" width="100%" />


{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9, size = 4) +
  geom_point(aes(color = close), size = 15) +
  geom_text(aes(y = y - 0.15), size = 8) +
  scale_color_viridis() +
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-12-1.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" width="100%" />


{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9, size = 4) +
  geom_point(aes(color = between), size = 15) +
  geom_text(aes(y = y - 0.15), size = 8) +
  scale_color_viridis() +
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-13-1.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" width="100%" />


## Clusters


{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9, size = 4) +
  geom_point(aes(color = cluster), size = 15, show.legend = FALSE) +
  geom_text(aes(y = y - 0.15), size = 8) +
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-14-1.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" width="100%" />


## Social Network


{% highlight r %}
nodes <- read_csv("~/gh/stat_data/work_nodes.csv")
{% endhighlight %}



{% highlight text %}
## Parsed with column specification:
## cols(
##   id = col_integer(),
##   age = col_integer(),
##   tenure = col_double(),
##   level = col_integer(),
##   department = col_integer()
## )
{% endhighlight %}



{% highlight r %}
edges <- read_csv("~/gh/stat_data/work_edges.csv")
{% endhighlight %}



{% highlight text %}
## Parsed with column specification:
## cols(
##   id = col_integer(),
##   id_out = col_integer(),
##   advice = col_integer(),
##   friendship = col_integer(),
##   reports = col_integer()
## )
{% endhighlight %}


{% highlight r %}
library(smodels)
temp <- graph_data(filter(edges, reports == 1), nodes, directed = TRUE)
nodes <- temp$nodes
edges <- temp$edges
{% endhighlight %}



{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9,
               arrow = arrow(type = "closed", angle = 15)) +
  geom_point(aes(color = factor(between)), size = 6) +
  #scale_color_viridis() + 
  theme_void()
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-17-1.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" width="100%" />


## Other Networks


## 




{% highlight r %}
z <- graph_data(nodes, edges)
{% endhighlight %}



{% highlight text %}
## Error in inner_join_impl(x, y, by$x, by$y, suffix$x, suffix$y, check_na_matches(na_matches)): Can't join on 'id' x 'id' because of incompatible types (character / integer)
{% endhighlight %}



{% highlight r %}
nodes <- z$nodes
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'z' not found
{% endhighlight %}



{% highlight r %}
edges <- z$edges
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'z' not found
{% endhighlight %}


{% highlight r %}
ggplot(nodes, aes(x, y, label = id)) +
  geom_segment(aes(xend = xend, yend = yend), data = edges,
               color = grey(0.9), alpha = 0.9) +
  geom_point(aes(color = eigen), size = 3, show.legend = FALSE) +
  scale_color_viridis() + 
  theme_void()
{% endhighlight %}



{% highlight text %}
## Error in eval(expr, envir, enclos): object 'xend' not found
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-20-1.png" title="plot of chunk unnamed-chunk-20" alt="plot of chunk unnamed-chunk-20" width="100%" />


{% highlight r %}
ggplot(nodes, aes(eigen, between)) +
  geom_point() +
  geom_text(aes(y = between + 50, label = id), data = nodes[nodes$between > 250,]) +
  geom_point(color = "red", data = nodes[nodes$between > 250,]) +
  theme_minimal()
{% endhighlight %}



{% highlight text %}
## Warning: Unknown or uninitialised column: 'between'.
{% endhighlight %}



{% highlight text %}
## Warning: Unknown or uninitialised column: 'between'.
{% endhighlight %}



{% highlight text %}
## Don't know how to automatically pick scale for object of type function. Defaulting to continuous.
## Don't know how to automatically pick scale for object of type function. Defaulting to continuous.
{% endhighlight %}



{% highlight text %}
## Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, : arguments imply differing number of rows: 0, 112
{% endhighlight %}

<img src="../assets/2017-11-14-class22/unnamed-chunk-21-1.png" title="plot of chunk unnamed-chunk-21" alt="plot of chunk unnamed-chunk-21" width="100%" />

